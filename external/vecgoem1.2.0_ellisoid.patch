From 8b71b8fe75a508d1884d4d294ab7bd7f82ec82bd Mon Sep 17 00:00:00 2001
From: Xiao-Xiao Cai <caixx@ihep.ac.cn>
Date: Thu, 15 Sep 2022 16:56:22 +0800
Subject: [PATCH] update

---
 persistency/gdml/source/include/Middleware.h |  2 ++
 persistency/gdml/source/src/Middleware.cpp   | 31 +++++++++++++++++++-
 2 files changed, 32 insertions(+), 1 deletion(-)

diff --git a/persistency/gdml/source/include/Middleware.h b/persistency/gdml/source/include/Middleware.h
index 9c7be1ff..443a3da2 100644
--- a/persistency/gdml/source/include/Middleware.h
+++ b/persistency/gdml/source/include/Middleware.h
@@ -90,6 +90,8 @@ private:

   vecgeom::VECGEOM_IMPL_NAMESPACE::VUnplacedVolume const *processOrb(
       XERCES_CPP_NAMESPACE_QUALIFIER DOMNode const *aDOMNode);
+  const vecgeom::VECGEOM_IMPL_NAMESPACE::VUnplacedVolume *processEllipsoid(
+      XERCES_CPP_NAMESPACE_QUALIFIER DOMNode const *aDOMNode);
   const vecgeom::VECGEOM_IMPL_NAMESPACE::VUnplacedVolume *processBox(
       XERCES_CPP_NAMESPACE_QUALIFIER DOMNode const *aDOMNode);
   const vecgeom::VECGEOM_IMPL_NAMESPACE::VUnplacedVolume *processTube(
diff --git a/persistency/gdml/source/src/Middleware.cpp b/persistency/gdml/source/src/Middleware.cpp
index 51fd94a4..f7a1cdd7 100644
--- a/persistency/gdml/source/src/Middleware.cpp
+++ b/persistency/gdml/source/src/Middleware.cpp
@@ -35,6 +35,7 @@
 #include "VecGeom/volumes/UnplacedTet.h"
 #include "VecGeom/volumes/UnplacedScaledShape.h"
 #include "VecGeom/volumes/UnplacedSExtruVolume.h"
+#include "VecGeom/volumes/UnplacedEllipsoid.h"

 #include "VecGeom/volumes/LogicalVolume.h"
 #include "VecGeom/volumes/PlacedVolume.h"
@@ -591,6 +592,8 @@ bool Middleware::processSolid(XERCES_CPP_NAMESPACE_QUALIFIER DOMNode const *aDOM
       return processOrb(aDOMNode);
     } else if (name == "box") {
       return processBox(aDOMNode);
+    } else if (name == "ellipsoid") {
+      return processEllipsoid(aDOMNode);
     } else if (name == "tube") {
       return processTube(aDOMNode);
     } else if (name == "cutTube") {
@@ -903,6 +906,32 @@ const vecgeom::VECGEOM_IMPL_NAMESPACE::VUnplacedVolume *Middleware::processSpher
   return anUnplacedSpherePtr;
 }

+const vecgeom::VECGEOM_IMPL_NAMESPACE::VUnplacedVolume *Middleware::processEllipsoid(
+    XERCES_CPP_NAMESPACE_QUALIFIER DOMNode const *aDOMNode)
+{
+  if (debug) {
+    std::cout << "Middleware::processEllipsoid: processing: " << Helper::GetNodeInformation(aDOMNode) << std::endl;
+  }
+
+  auto const *const attributes = aDOMNode->getAttributes();
+  auto const lengthMultiplier  = GetLengthMultiplier(aDOMNode);
+  DECLAREANDGETLENGTVAR(ax)
+  DECLAREANDGETLENGTVAR(by)
+  DECLAREANDGETLENGTVAR(cz)
+  // DECLAREANDGETLENGTVAR(zcut1)
+  // DECLAREANDGETLENGTVAR(zcut2)
+  DECLAREHALF(ax)
+  DECLAREHALF(by)
+  DECLAREHALF(cz)
+  // DECLAREHALF(zcut1)
+  // DECLAREHALF(zcut2)
+  auto const anUnplacedEllipsoidPtr =
+      vecgeom::VECGEOM_IMPL_NAMESPACE::GeoManager::MakeInstance<vecgeom::VECGEOM_IMPL_NAMESPACE::UnplacedEllipsoid>(
+          halfax, halfby, halfcz);
+  return anUnplacedEllipsoidPtr;
+
+}
+
 const vecgeom::VECGEOM_IMPL_NAMESPACE::VUnplacedVolume *Middleware::processParallelepiped(
     XERCES_CPP_NAMESPACE_QUALIFIER DOMNode const *aDOMNode)
 {
@@ -1287,7 +1316,7 @@ bool Middleware::processLogicVolume(XERCES_CPP_NAMESPACE_QUALIFIER DOMNode const
       }
     } else if (theChildNodeName == "physvol") {
       auto const success = processPhysicalVolume(aDOMElement, logicVolume);
-      if(!success) return false;
+      if(!success) return false;
     } else if (theChildNodeName == "auxiliary") {
       Auxiliary aux;
       auto const success = processAuxiliary(aDOMElement, aux);
--
2.25.1
