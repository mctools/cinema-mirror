#!/usr/bin/env python3

from Cinema.Prompt import Launcher, Visualiser
from Cinema.Prompt.geo import Box, Volume, Transformation3D, Tessellated
from Cinema.Prompt.gun import PythonGun


gunCfg = "gun=SimpleThermalGun;energy=3;position=0,0,-200;direction=0,0,1"
scorerCfg_det = "Scorer=NeutronSq;name=SofQ;sample_position=0,0,1;beam_direction=0,0,1;dist=-100;ptstate=ENTRY;linear=yes;Qmin=0.5; Qmax = 50; numbin=100"
scorerCfg_detpsd = "Scorer=PSD;name=NeutronHistMap;xmin=-500;xmax=500;numBins_x=10;ymin=-500;ymax=500;numBins_y=10;ptstate=SURFACE;type=XY"

matCfg_sample = "physics=ncrystal;nccfg='LiquidHeavyWaterD2O_T293.6K.ncmat';scatter_bias=10;abs_bias=1"

l = Launcher()
l.setSeed(4096)
world = Volume("world", Box(210, 210, 210))


detector = Volume("Det", Box(400, 400, 0.0001), scorerCfg = [scorerCfg_det, scorerCfg_detpsd])
sample = Volume("sample", Box(20,20,20))
water = Volume('sbox', Box(2,2,2), matCfg = matCfg_sample)

for i in range(10):
    sample.placeChild("ssample", water, Transformation3D(0,0,2.2*(i-5.0)), scorerGroup=i)


world.placeChild("physicalbox", detector, Transformation3D(0., 0., 50, sx=2, sy=2), 1)
world.placeChild("physicalbox2", sample, Transformation3D(z=-150, rx=45, ry=45))


l.setWorld(world)
l.setGun(gunCfg)
l.showWorld(1000)

# gun = PythonGun()
# l.setPythonGun(gun)

# l.go(1000000)

# psd = l.getHist(scorerCfg_det)
# psd.plot(show=True)

